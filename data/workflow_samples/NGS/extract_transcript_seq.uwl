#@UGENE_WORKFLOW
#Uses input transcripts and genomic sequences to generate a FASTA file with the DNA sequences for the transcripts.
#Please make sure that contig or chromosome names in the transcript file(s) have corresponding entries in the input sequence(s).



workflow "Extract transcript sequences"{

    read-sequence {
        type:read-sequence;
        name:"Read Sequence(s)";
        url-in {
            dataset:"Dataset 1";
        }
    }
    read-annotations {
        type:read-annotations;
        name:"Read Transcripts";
        url-in {
            dataset:"Dataset 1";
        }
    }
    multiplexer {
        type:multiplexer;
        name:Multiplexer;
    }
    write-sequence {
        type:write-sequence;
        name:"Write Extracted Sequences";
        url-out:extracted.fa;
    }
    extract-annotated-sequence {
        type:extract-annotated-sequence;
        name:"Get Sequences by Annotations";
    }


    .actor-bindings {
        read-annotations.out-annotations->multiplexer.input-data-2
        read-sequence.out-sequence->multiplexer.input-data-1
        multiplexer.output-data->extract-annotated-sequence.in-sequence
        extract-annotated-sequence.out-sequence->write-sequence.in-sequence
    }

    extract-annotated-sequence.annotations->write-sequence.in-sequence.annotations
    read-annotations.annotations->write-sequence.in-sequence.annotations
    read-sequence.annotations->write-sequence.in-sequence.annotations
    extract-annotated-sequence.sequence->write-sequence.in-sequence.sequence
    read-annotations.annotations->extract-annotated-sequence.in-sequence.annotations
    read-sequence.sequence->extract-annotated-sequence.in-sequence.sequence

    .meta {
        visual {
            extract-annotated-sequence {
                pos:"-380 -571";
                style:ext;
                bg-color-ext:"0 128 128 64";
                in-sequence.angle:180;
                out-sequence.angle:360;
            }
            multiplexer {
                pos:"-682 -572";
                style:ext;
                bg-color-ext:"0 128 128 64";
                input-data-1.angle:150;
                input-data-2.angle:210;
                output-data.angle:360;
            }
            read-annotations {
                pos:"-898 -454";
                style:ext;
                bg-color-ext:"0 128 128 64";
                bounds:"-30 -30 76 103";
                out-annotations.angle:360;
            }
            read-sequence {
                pos:"-897 -643";
                style:ext;
                bg-color-ext:"0 128 128 64";
                bounds:"-30 -30 74 104";
                out-sequence.angle:360;
            }
            write-sequence {
                pos:"-80 -571";
                style:ext;
                bg-color-ext:"0 128 128 64";
                in-sequence.angle:180;
            }
            extract-annotated-sequence.out-sequence->write-sequence.in-sequence {
                text-pos:"-43 -46";
            }
            multiplexer.output-data->extract-annotated-sequence.in-sequence {
                text-pos:"-46 -61";
            }
            read-annotations.out-annotations->multiplexer.input-data-2 {
                text-pos:"-42 -8";
            }
            read-sequence.out-sequence->multiplexer.input-data-1 {
                text-pos:"-33.5 -11";
            }
        }
        wizard {
            name:"Extract Transcript Sequences Wizard";
            page {
                id:1;
                title:"Extract Transcript Sequences";
                parameters-area {
                    group {
                        title:"Input parameters";
                        label-size:120;
                        read-sequence.url-in {
                            label:"Genomic sequences";
                        }
                        read-annotations.url-in {
                            label:Transcripts;
                        }
                    }
                    group {
                        title:"Extracted sequences";
                        label-size:120;
                        write-sequence.url-out {
                            label:"Output file";
                        }
                    }
                }
            }
        }
    }
}

